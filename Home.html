<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tính điểm GPA</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            text-align: center;
        }
        table {
            margin: 0 auto;
            border-collapse: collapse;
            width: 90%;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 10px;
            text-align: center;
        }
        input, select {
            padding: 5px;
        }
    </style>
</head>
<body>
    <h1>Tính điểm GPA</h1>

    <!-- Bảng nhập điểm -->
    <table>
        <thead>
            <tr>
                <th>STT</th>
                <th>Tên học phần</th>
                <th>Điểm chữ</th>
                <th>Tín chỉ</th>
                <th>Thao tác</th>
            </tr>
        </thead>
        <tbody id="subjects">
            <tr>
                <td>1</td>
                <td><input type="text" class="subject-name" placeholder="Nhập tên học phần"></td>
                <td>
                    <select class="grade">
                        <option value="A">A (4.0)</option>
                        <option value="B+">B+ (3.5)</option>
                        <option value="B">B (3.0)</option>
                        <option value="C+">C+ (2.5)</option>
                        <option value="C">C (2.0)</option>
                        <option value="D+">D+ (1.5)</option>
                        <option value="D">D (1.0)</option>
                        <option value="F">F (0.0)</option>
                    </select>
                </td>
                <td><input type="number" class="credits" placeholder="Nhập số tín chỉ" min="1"></td>
                <td><button onclick="deleteRow(this)">Xóa</button></td>
            </tr>
        </tbody>
    </table>
    <br>
    <button onclick="addRow()">Thêm học phần</button>
    <button onclick="calculateGPA()">Tính GPA</button>
    <button onclick="exportToExcel()">Xuất Excel</button>
    <h2 id="result"></h2>
    <h3 id="total-credits"></h3>

    <script>
        // Map letter grades to GPA points
        const gradeToPoint = {
            'A': 4.0,
            'B+': 3.5,
            'B': 3.0,
            'C+': 2.5,
            'C': 2.0,
            'D+': 1.5,
            'D': 1.0,
            'F': 0.0
        };

        // Add a new row to the table
        function addRow() {
            const table = document.getElementById('subjects');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>${table.children.length + 1}</td>
                <td><input type="text" class="subject-name" placeholder="Nhập tên học phần"></td>
                <td>
                    <select class="grade">
                        <option value="A">A (4.0)</option>
                        <option value="B+">B+ (3.5)</option>
                        <option value="B">B (3.0)</option>
                        <option value="C+">C+ (2.5)</option>
                        <option value="C">C (2.0)</option>
                        <option value="D+">D+ (1.5)</option>
                        <option value="D">D (1.0)</option>
                        <option value="F">F (0.0)</option>
                    </select>
                </td>
                <td><input type="number" class="credits" placeholder="Nhập số tín chỉ" min="1"></td>
                <td><button onclick="deleteRow(this)">Xóa</button></td>
            `;
            table.appendChild(newRow);
        }

        // Delete a row
        function deleteRow(button) {
            const row = button.parentElement.parentElement;
            row.parentElement.removeChild(row);
            updateRowNumbers();
        }

        // Update row numbers after deletion
        function updateRowNumbers() {
            const rows = document.querySelectorAll("#subjects tr");
            rows.forEach((row, index) => {
                row.children[0].innerText = index + 1;
            });
        }

        // Calculate GPA and total credits
        function calculateGPA(forExport = false) {
            const grades = document.querySelectorAll('.grade');
            const credits = document.querySelectorAll('.credits');
            let totalPoints = 0;
            let totalCredits = 0;

            grades.forEach((gradeElement, index) => {
                const grade = gradeElement.value;
                const credit = parseFloat(credits[index].value);

                if (gradeToPoint[grade] !== undefined && credit > 0) {
                    totalPoints += gradeToPoint[grade] * credit;
                    totalCredits += credit;
                }
            });

            const gpa = totalCredits > 0 ? (totalPoints / totalCredits).toFixed(2) : 0;

            if (forExport) {
                return { gpa, totalCredits }; // Return GPA and total credits for export
            }

            document.getElementById('result').innerText = `GPA của bạn: ${gpa}`;
            document.getElementById('total-credits').innerText = `Tổng số tín chỉ tích lũy: ${totalCredits}`;
        }

        // Export to Excel with total credits and GPA
        function exportToExcel() {
            const rows = [];
            const tableRows = document.querySelectorAll("#subjects tr");

            // Add table headers
            rows.push(["STT", "Tên học phần", "Điểm chữ", "Điểm số", "Tín chỉ"]);

            // Loop through each row in the table
            tableRows.forEach((row, index) => {
                const subjectName = row.querySelector(".subject-name").value || "N/A";
                const grade = row.querySelector(".grade").value || "N/A";
                const gradeScore = gradeToPoint[grade] || "N/A";
                const credit = row.querySelector(".credits").value || "N/A";
                rows.push([index + 1, subjectName, grade, gradeScore, credit]);
            });

            // Add total credits and GPA row
            const { gpa, totalCredits } = calculateGPA(true);
            rows.push(["", "", "Tổng số tín chỉ", "", totalCredits]);
            rows.push(["", "", "GPA", "", gpa]);

            // Convert rows to CSV format
            const csvContent = rows.map(row => row.join(",")).join("\n");

            // Create and download the CSV file
            const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "GPA_Calculator.csv";
            link.click();
        }
    </script>
</body>
</html>
